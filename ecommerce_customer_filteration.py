from flask import Flask, request, jsonify, json
from flask_api import status
from jinja2._compat import izip
from datetime import datetime,timedelta,date
import datetime
import pymysql
from flask_cors import CORS, cross_origin
from flask import Blueprint
from flask_restplus import Api, Resource, fields
from werkzeug.utils import cached_property
from werkzeug.datastructures import FileStorage
from pyfcm import FCMNotification
import requests
import calendar
import json

app = Flask(__name__)
cors = CORS(app)

#----------------------database-connection---------------------#
'''def mysql_connection():
	connection = pymysql.connect(host='creamsonservices.com',
	                             user='creamson_langlab',
	                             password='Langlab@123',
	                             db='creamson_ecommerce',
	                             charset='utf8mb4',
	                             cursorclass=pymysql.cursors.DictCursor)
	return connection'''

def mysql_connection():
	connection = pymysql.connect(host='ecommerce.cdcuaa7mp0jm.us-east-2.rds.amazonaws.com',
	                             user='admin',
	                             password='oxjkW0NuDtjKfEm5WZuP',
	                             db='ecommerce',
	                             charset='utf8mb4',
	                             cursorclass=pymysql.cursors.DictCursor)
	return connection

#----------------------database-connection---------------------#

ecommerce_customer_filteration = Blueprint('ecommerce_customer_filteration', __name__)
api = Api(ecommerce_customer_filteration, version='1.0', title='Ecommerce API',
    description='Ecommerce API')

name_space = api.namespace('EcommerceCustomerFilteration',description='Ecommerce Customer Filteration')

BASE_URL = 'http://ec2-18-221-89-14.us-east-2.compute.amazonaws.com/flaskapp/'

#-----------------------------------------------------------------#

#--------------------------------------------------------------------#
@name_space.route("/getCustomerListByFilter/<string:sdate>/<int:pincode>/<string:model>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByFilter(Resource):
	def get(self,sdate,pincode,model,brand,pcost,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateOrganizationId/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePincodeOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandModelOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePurchaseCostOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandPurchaseCostOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByPincodeBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStore/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,start,limit,page)
			filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		
		print(filterURL)	
		filterRes = requests.get(filterURL).json()	
		connection.commit()
		cursor.close()
		return filterRes

		#---------------------------------------------------------------------#

#--------------------------------------------------------------------#
@name_space.route("/getCustomerListByFilterNew/<string:sdate>/<int:pincode>/<string:model>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:purchase_date_range>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByFilterNew(Resource):
	def get(self,sdate,pincode,model,brand,pcost,organisation_id,retailer_store_id,purchase_date_range):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateOrganizationId/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n': 
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePincodeOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandModelOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePurchaseCostOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandPurchaseCostOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByPincodeBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStore/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,start,limit,page)
			#filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDate/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDate/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)


		
		print(filterURL)	
		filterRes = requests.get(filterURL).json()	
		connection.commit()
		cursor.close()
		return filterRes

		#---------------------------------------------------------------------#

#--------------------------------------------------------------------#
@name_space.route("/getCustomerListByFilterWithCategory/<string:sdate>/<int:pincode>/<string:model>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:purchase_date_range>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByFilterWithCategory(Resource):
	def get(self,sdate,pincode,model,brand,pcost,organisation_id,retailer_store_id,purchase_date_range,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateOrganizationId/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0: 
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePincodeOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandModelOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePurchaseCostOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandPurchaseCostOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByPincodeBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStore/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,start,limit,page)
			#filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDate/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0: 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDate/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0: 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)


		



		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdCategoryId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,category_id,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0: 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,category_id,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,category_id,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,category_id,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)
			#filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0: 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0: 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0:
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		print(filterURL)	
		filterRes = requests.get(filterURL).json()	
		connection.commit()
		cursor.close()
		return filterRes

#---------------------------------------------------------------------#


#--------------------------------------------------------------------#
@name_space.route("/getCustomerListByFilterWithCategoryAndProductType/<string:sdate>/<int:pincode>/<string:model>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:purchase_date_range>/<int:category_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByFilterWithCategoryAndProductType(Resource):
	def get(self,sdate,pincode,model,brand,pcost,organisation_id,retailer_store_id,purchase_date_range,category_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateOrganizationId/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n': 
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePincodeOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandModelOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDatePurchaseCostOrganizationId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByDateBrandPurchaseCostOrganizationId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "retcustomer_notify/EcommerceNotification/getCustomerListByPincodeBrandModelPurchaseCostOrganizationId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStore/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,start,limit,page)
			#filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStore/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDate/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDate/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDate/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,start,limit,page)


		



		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdCategoryId/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,category_id,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,category_id,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,category_id,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,category_id,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)
			#filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type == 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/{}/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,category_id,start,limit,page)








		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0  and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdProductType/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,product_type,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdProductType/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,product_type,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdProductType/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,product_type,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,product_type,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdProductType/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,product_type,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,product_type,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdProductType/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,product_type,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdProductType/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,product_type,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStoreProductType/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,product_type,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStoreProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,product_type,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStoreProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStoreProductType/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,product_type,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0  and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStoreProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,product_type,start,limit,page)
			#filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreProductType/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,product_type,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreProductType/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreProductType/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateProductType/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateProductType/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0  and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateProductType/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateProductType/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateProductType/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id == 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/{}/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,start,limit,page)






		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0  and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdProductTypeCategoryId/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,product_type,category_id,start,limit,page)
			
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n': 
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdProductTypeCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,product_type,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdProductTypeCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,product_type,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,product_type,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdProductTypeCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,product_type,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,product_type,category_id,start,limit,page)
			
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,product_type,category_id,start,limit,page)
			

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,product_type,category_id,start,limit,page)
		

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)
			
		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0  and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)
			#filterRes = requests.get(filterURL).json()
		
		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)
		
		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range == 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0  and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id == 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateOrganizationIdPurchaseDateRetailStoreProductTypeCategoryIdCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  == 'n' and brand == 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost == '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand == 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  == 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  == 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		if date != None and pincode  != 0 and model  != 'n' and brand != 'n' and pcost != '0' and organisation_id != None and retailer_store_id != 0 and purchase_date_range != 'n' and category_id != 0 and product_type != 'n':
			filterURL = BASE_URL + "ecommerce_customer_filteration/EcommerceCustomerFilteration/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/{}/{}/{}/{}/{}/{}/{}/{}/{}/{}?start={}&limit={}&page={}".format(sdate,pincode,brand,model,pcost,organisation_id,purchase_date_range,retailer_store_id,product_type,category_id,start,limit,page)

		print(filterURL)	
		filterRes = requests.get(filterURL).json()	
		connection.commit()
		cursor.close()
		return filterRes

#---------------------------------------------------------------------#

@name_space.route("/getCustomerListByDateOrganizationIdRetailStore/<string:sdate>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdRetailStore(Resource):
	def get(self,sdate,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		print('hiii')

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(organisation_id,organisation_id,retailer_store_id,sdate,today))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(organisation_id,organisation_id,retailer_store_id,sdate,today))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 and 
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
				date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",(organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and 
				and admin_id>%s and date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",
				(organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdRetailStore/<string:sdate>/<int:pincode>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdRetailStore(Resource):
	def get(self,sdate,pincode,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT a.`admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",(organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(a.`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				 INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				 WHERE a.`role_id`=4 and 
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s  and `pincode` in (%s) order by admin_id ASC limit %s""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
				WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				and a.`admin_id`>%s and date(a.`date_of_creation`) between %s and %s and 
				pincode in (%s) order by admin_id ASC limit %s""",
				(organisation_id,organisation_id,retailer_store_id,start,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdRetailStore/<string:sdate>/<string:brand>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdRetailStore(Resource):
	def get(self,sdate,brand,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,organisation_id,organisation_id,retailer_store_id,start,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdRetailStore/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdRetailStore(Resource):
	def get(self,sdate,brand,model,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(ad.`admin_id`)as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,sdate,today,organisation_id,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(ad.`admin_id`))as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,sdate,today,organisation_id,organisation_id,retailer_store_id))

		print(cursor._last_executed)

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:			
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,start,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if next_url:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdRetailStore/<string:sdate>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdRetailStore(Resource):
	def get(self,sdate,pcost,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		scost = float(startingcost)
		ecost = float(endingcost)

		cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost))
		customer_list_data = cursor.fetchall()
		
		cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					and date(`date_of_creation`) between %s and %s""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:	
						customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(`date_of_creation`) between %s and %s""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

			if prdcusmrDtls:

				page_next = page + 1			
				if cur_count < total_count:
					next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
				else:
					next_url = ''
			else:
				next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStore/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					`organisation_id` = %s ) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(brand,organisation_id,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))		

			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')

		total_count = len(details)
		print(total_count)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					`organisation_id` = %s ) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					print(customerids)

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						`organisation_id` = %s ) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					`organisation_id` = %s ) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						`organisation_id` = %s ) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStore/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStore(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:											
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
						ad.`admin_id` in %s and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#
@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStore/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStore(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:					
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						cscost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0			 	
						
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids :
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#--------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDate/<string:sdate>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(organisation_id,organisation_id,sdate,today,start_date,end_date))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(organisation_id,organisation_id,sdate,today,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",(organisation_id,organisation_id,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",
				(organisation_id,organisation_id,start,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDate/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) order by admin_id ASC limit %s""",
			(organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) order by admin_id ASC limit %s""",
				(organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDate/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDate/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDate/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDate/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a			
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s""",
			(brand,organisation_id,organisation_id,sdate,today,organisation_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					`organisation_id` = %s ) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						`organisation_id` = %s ) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					`organisation_id` = %s ) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						`organisation_id` = %s ) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDate/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		print(userDtls)

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])	
				print(customerids)									

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDate/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,pincode,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,start,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDateRetailStore/<string:sdate>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDate(Resource):
	def get(self,sdate,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",(organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(organisation_id,organisation_id,start,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStore/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStore(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s)  and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
			(organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStore/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStore(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStore/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStore(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s)
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStore/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStore(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStore/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStore(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`		
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					`organisation_id` = %s ) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						`organisation_id` = %s ) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					`organisation_id` = %s ) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id ASC limit %s""",
					(brand,organisation_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						details.append(userDtls[i]['admin_id'])		
					else:
						print('hiii')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						`organisation_id` = %s ) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and `organisation_id` = %s and `product_id` in %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))

					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')										

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStore(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date,retailer_store_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and `organisation_id` = %s and `product_id` in %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and `organisation_id` = %s and `product_id` in %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and `organisation_id` = %s and `product_id` in %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdCategoryId/<string:sdate>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdCategoryId(Resource):
	def get(self,sdate,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		print('hiii')

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and `organisation_id`= %s and date(`date_of_creation`) BETWEEN %s and %s""",(category_id,organisation_id,organisation_id,organisation_id,sdate,today))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`) as `count` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and `organisation_id`= %s and date(`date_of_creation`) BETWEEN %s and %s""",(category_id,organisation_id,organisation_id,organisation_id,sdate,today))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` 
				WHERE `role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s and 
				date(`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",(category_id,organisation_id,organisation_id,organisation_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` WHERE `role_id`=4
				and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s 
				and admin_id>%s and date(`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",
				(category_id,organisation_id,organisation_id,organisation_id,start,sdate,today,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

@name_space.route("/getCustomerListByDatePincodeOrganizationIdCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins`
			WHERE `role_id`=4 and `admin_id` in 
			(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s and `pincode` in (%s)""",(category_id,organisation_id,organisation_id,organisation_id,sdate,today,pincode))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`)as count FROM `admins` ad
			WHERE `role_id`=4 and `admin_id` in 
			(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s and `pincode` in (%s)""",
			(category_id,organisation_id,organisation_id,organisation_id,sdate,today,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` WHERE `role_id`=4 and 
				`admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s  and `pincode` in (%s) order by admin_id ASC limit %s""",
			(category_id,organisation_id,organisation_id,organisation_id,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` WHERE `role_id`=4 and 
				`admin_id` in (SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s 
				and admin_id>%s and date(`date_of_creation`) between %s and %s and 
				pincode in (%s) order by admin_id ASC limit %s""",
				(category_id,organisation_id,organisation_id,organisation_id,start,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM 
				`product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`)as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				 WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,start,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s)
			and `customer_id` !=0)) and date(`date_of_creation`) BETWEEN %s and %s and 
			`organisation_id`=%s""",(brand,organisation_id,split_model,category_id,sdate,today,organisation_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(`date_of_creation`) BETWEEN %s and %s and 
			`organisation_id`=%s""",
			(brand,organisation_id,split_model,category_id,sdate,today,organisation_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`)as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,start,category_id,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		scost = float(startingcost)
		ecost = float(endingcost)

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,category_id,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()
		
		cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,category_id,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins`
					WHERE `organisation_id`=%s and date(`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,category_id,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins`
					WHERE `organisation_id`=%s and date(`date_of_creation`) between %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
					`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,sdate,today,category_id,organisation_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,start,customerids,category_id,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))		

			if payment_count > 0:					
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` 
					FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id` in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdCategoryId(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom. `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` WHERE 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#
@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:
						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')
				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,start,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#--------------------------------------------------------------------#

@name_space.route("/getCustomerListByDateOrganizationIdRetailStoreCategoryId/<string:sdate>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		print('hiii')

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0)  and `organisation_id`= %s)  and
			a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)  and
			a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)  and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
				date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 a.`status`=1 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)  and
				and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and 
				and admin_id>%s and date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",
				(organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK


#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdRetailStoreCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT a.`admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(a.`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and 
			a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				 INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				 WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s  and `pincode` in (%s) order by admin_id ASC limit %s""",
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
				WHERE a.`role_id`=4 and 
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				and a.`admin_id`>%s and date(a.`date_of_creation`) between %s and %s and 
				pincode in (%s) order by admin_id ASC limit %s""",
				(category_id,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,start,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdRetailStoreCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s  and p.`category_id` =%s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,organisation_id,organisation_id,retailer_store_id,start,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdRetailStoreCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(ad.`admin_id`)as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,category_id,sdate,today,organisation_id,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(ad.`admin_id`))as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,category_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		print(cursor._last_executed)

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id` in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,category_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:			
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,category_id,start,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if next_url:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdRetailStoreCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		scost = float(startingcost)
		ecost = float(endingcost)

		customerList_query = cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost,category_id,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()
		
		cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost,category_id,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					and date(`date_of_creation`) between %s and %s""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:	
						customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and
						`admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,category_id,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
					and date(`date_of_creation`) between %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
					`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today,category_id,organisation_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s 
						and `admin_id` in %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,category_id,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

			if prdcusmrDtls:

				page_next = page + 1			
				if cur_count < total_count:
					next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
				else:
					next_url = ''
			else:
				next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))		

			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')

		total_count = len(details)
		print(total_count)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					print(customerids)

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						 WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:											
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
						ad.`admin_id` in %s and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#
@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom 
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:					
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						cscost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0			 	
						
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s nad p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids :
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#--------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDateCategoryId/<string:sdate>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",
				(category_id,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) order by admin_id ASC limit %s""",
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) order by admin_id ASC limit %s""",
				(category_id,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#


#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDateCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDateCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,category_id,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,category_id,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s 
						and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,category_id,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s 
						and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,category_id,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a			
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping`pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category_id,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and p.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		print(userDtls)

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and p.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`caetgory_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,caetgory_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])	
				print(customerids)									

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and p.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and p.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
					WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,start,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and p.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
				and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(category_id,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) 
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s)  and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
			(category_id,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
				and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(category_id,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
			pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom 
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
			pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s)
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and `admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id,category_id,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and `admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id,category_id,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s order by admin_id ASC limit %s""",
						(category_id,organisation_id,organisation_id,organisation_id,sdate,today,customerids,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id,category_id,organisation_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`category_id` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,category_id,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`		
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category_id,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id ASC limit %s""",
					(brand,organisation_id,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						details.append(userDtls[i]['admin_id'])		
					else:
						print('hiii')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`category` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,category,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))

					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')										

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date,retailer_store_id,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						 WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,category_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,category_id,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`category_id` = %S) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,category_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdProductType/<string:sdate>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdProductType(Resource):
	def get(self,sdate,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		print('hiii')

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and `organisation_id`= %s and date(`date_of_creation`) BETWEEN %s and %s""",(product_type,organisation_id,organisation_id,organisation_id,sdate,today))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`) as `count` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and `organisation_id`= %s and date(`date_of_creation`) BETWEEN %s and %s""",(product_type,organisation_id,organisation_id,organisation_id,sdate,today))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` 
				WHERE `role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s and 
				date(`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",(product_type,organisation_id,organisation_id,organisation_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` WHERE `role_id`=4
				and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s 
				and admin_id>%s and date(`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,start,sdate,today,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#

@name_space.route("/getCustomerListByDatePincodeOrganizationIdProductType/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdproductType(Resource):
	def get(self,sdate,pincode,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins`
			WHERE `role_id`=4 and `admin_id` in 
			(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s and `pincode` in (%s)""",(product_type,organisation_id,organisation_id,organisation_id,sdate,today,pincode))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`)as count FROM `admins` ad
			WHERE `role_id`=4 and `admin_id` in 
			(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s and `pincode` in (%s)""",
			(product_type,organisation_id,organisation_id,organisation_id,sdate,today,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` WHERE `role_id`=4 and 
				`admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s  and `pincode` in (%s) order by admin_id ASC limit %s""",
			(product_type,organisation_id,organisation_id,organisation_id,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` WHERE `role_id`=4 and 
				`admin_id` in (SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s 
				and admin_id>%s and date(`date_of_creation`) between %s and %s and 
				pincode in (%s) order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,start,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#


#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdProductType/<string:sdate>/<string:brand>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdProductType(Resource):
	def get(self,sdate,brand,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM 
				`product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`)as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				 WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,start,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdProductType/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdProductType(Resource):
	def get(self,sdate,brand,model,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s)
			and `customer_id` !=0)) and date(`date_of_creation`) BETWEEN %s and %s and 
			`organisation_id`=%s""",(brand,organisation_id,split_model,product_type,sdate,today,organisation_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0)) and date(`date_of_creation`) BETWEEN %s and %s and 
			`organisation_id`=%s""",
			(brand,organisation_id,split_model,product_type,sdate,today,organisation_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`)as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,start,product_type,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdProductType/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdProductType(Resource):
	def get(self,sdate,pcost,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		scost = float(startingcost)
		ecost = float(endingcost)

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()
		
		cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins`
					WHERE `organisation_id`=%s and date(`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,product_type,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins`
					WHERE `organisation_id`=%s and date(`date_of_creation`) between %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
					`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,sdate,today,product_type,organisation_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,start,customerids,product_type,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#


#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdProductType/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdProductType(Resource):
	def get(self,sdate,brand,pcost,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))		

			if payment_count > 0:					
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` 
					FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id` in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdProductType/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdProductType(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom. `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` WHERE 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#
@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdProductType/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdProductType(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:
						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')
				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#--------------------------------------------------------------------#

#--------------------------------------------------------------------#

@name_space.route("/getCustomerListByDateOrganizationIdRetailStoreProductType/<string:sdate>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdRetailStoreProductType(Resource):
	def get(self,sdate,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		print('hiii')

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0)  and `organisation_id`= %s)  and
			a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)  and
			a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)  and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
				date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 a.`status`=1 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)  and
				and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and 
				and admin_id>%s and date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK


#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdRetailStoreProductType/<string:sdate>/<int:pincode>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdRetailStoreProductType(Resource):
	def get(self,sdate,pincode,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT a.`admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(a.`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and 
			a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				 INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				 WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s  and `pincode` in (%s) order by admin_id ASC limit %s""",
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
				WHERE a.`role_id`=4 and 
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				and a.`admin_id`>%s and date(a.`date_of_creation`) between %s and %s and 
				pincode in (%s) order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,organisation_id,retailer_store_id,start,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#


#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdRetailStoreProductType/<string:sdate>/<string:brand>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdRetailStoreProductType(Resource):
	def get(self,sdate,brand,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s  and p.`product_type` =%s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,organisation_id,organisation_id,retailer_store_id,start,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#


#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdRetailStoreProductType/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdRetailStoreProductType(Resource):
	def get(self,sdate,brand,model,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(ad.`admin_id`)as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,product_type,sdate,today,organisation_id,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(ad.`admin_id`))as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,product_type,sdate,today,organisation_id,organisation_id,retailer_store_id))

		print(cursor._last_executed)

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id` in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:			
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,start,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if next_url:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdRetailStoreProductType/<string:sdate>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdRetailStoreProdctType(Resource):
	def get(self,sdate,pcost,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		scost = float(startingcost)
		ecost = float(endingcost)

		customerList_query = cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()
		
		cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					and date(`date_of_creation`) between %s and %s""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:	
						customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and
						`admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,product_type,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
					and date(`date_of_creation`) between %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
					`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today,product_type,organisation_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s 
						and `admin_id` in %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,product_type,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

			if prdcusmrDtls:

				page_next = page + 1			
				if cur_count < total_count:
					next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
				else:
					next_url = ''
			else:
				next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreProductType/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreProductType(Resource):
	def get(self,sdate,brand,pcost,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))		

			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')

		total_count = len(details)
		print(total_count)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					print(customerids)

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						 WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreProductType/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreProductType(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:											
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
						ad.`admin_id` in %s and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#


#----------------------------------------------------------------#
@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreProductType/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreProductType(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom 
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:					
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						cscost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0			 	
						
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s nad p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids :
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#--------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDateProductType/<string:sdate>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateProductType/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) order by admin_id ASC limit %s""",
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#


#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDateProductType/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDateProductType/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,product_type,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,product_type,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateProductType/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,product_type,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,product_type,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s 
						and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,product_type,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s 
						and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,product_type,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateProductType/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a			
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping`pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateProductType/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		print(userDtls)

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])	
				print(customerids)									

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateProductType/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
				and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) 
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s)  and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)
				and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
			pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom 
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
			pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,product_type,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,product_type,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s)
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and `admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id,product_type,organisation_id,organisation_id))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and `admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id,product_type,organisation_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s order by admin_id ASC limit %s""",
						(product_type,organisation_id,organisation_id,organisation_id,sdate,today,customerids,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id,product_type,organisation_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s)order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,product_type,organisation_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`		
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						details.append(userDtls[i]['admin_id'])		
					else:
						print('hiii')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#


#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))

					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')										

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductType(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date,retailer_store_id,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						 WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %S) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdProductTypeCategoryId/<string:sdate>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdProductTypeCategoryId(Resource):
	def get(self,sdate,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		print('hiii')

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and `organisation_id`= %s and date(`date_of_creation`) BETWEEN %s and %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,sdate,today))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`) as `count` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and `organisation_id`= %s and date(`date_of_creation`) BETWEEN %s and %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,sdate,today))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` 
				WHERE `role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s and 
				date(`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` WHERE `role_id`=4
				and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s 
				and admin_id>%s and date(`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,organisation_id,start,sdate,today,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#

@name_space.route("/getCustomerListByDatePincodeOrganizationIdProductTypeCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins`
			WHERE `role_id`=4 and `admin_id` in 
			(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s and `pincode` in (%s)""",(product_type,organisation_id,category_id,organisation_id,organisation_id,sdate,today,pincode))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`)as count FROM `admins` ad
			WHERE `role_id`=4 and `admin_id` in 
			(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s  and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s and `pincode` in (%s)""",
			(product_type,organisation_id,category_id,organisation_id,organisation_id,sdate,today,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` WHERE `role_id`=4 and 
				`admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			`status`=1 and `organisation_id`=%s and 
			date(`date_of_creation`) between %s and %s  and `pincode` in (%s) order by admin_id ASC limit %s""",
			(product_type,organisation_id,category_id,organisation_id,organisation_id,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` WHERE `role_id`=4 and 
				`admin_id` in (SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				`status`=1 and `organisation_id`=%s 
				and admin_id>%s and date(`date_of_creation`) between %s and %s and 
				pincode in (%s) order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,organisation_id,start,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdProductTypeCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdProductTypeCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM 
				`product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s  and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`)as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				 WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,start,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdProductTypeCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s)
			and `customer_id` !=0)) and date(`date_of_creation`) BETWEEN %s and %s and 
			`organisation_id`=%s""",(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(`date_of_creation`) BETWEEN %s and %s and 
			`organisation_id`=%s""",
			(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`)as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p ON p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,start,product_type,category_id,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`)as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdProductTypeCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdProductTypeCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		scost = float(startingcost)
		ecost = float(endingcost)

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,category_id,organisation_id))
		customer_list_data = cursor.fetchall()
		
		cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,category_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins`
					WHERE `organisation_id`=%s and date(`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,product_type,organisation_id,category_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins`
					WHERE `organisation_id`=%s and date(`date_of_creation`) between %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
					`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,sdate,today,product_type,organisation_id,category_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,start,customerids,product_type,organisation_id,category_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list_data':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdProductTypeCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdProductTypeCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(`date_of_creation`) BETWEEN %s and %s and `organisation_id`=%s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))		

			if payment_count > 0:					
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` 
					FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id` in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdProductType(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom. `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` WHERE 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#
@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdProductTypeCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,category_id,pincode,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:
						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')
				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s  and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,start,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s  and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0

						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#--------------------------------------------------------------------#

#--------------------------------------------------------------------#

@name_space.route("/getCustomerListByDateOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		print('hiii')

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT `admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0)  and `organisation_id`= %s)  and
			a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and a.`status`=1 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)  and
			a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)  and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
				date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE `role_id`=4 a.`status`=1 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)  and
				and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and 
				and admin_id>%s and date(a.`date_of_creation`) between %s and %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,retailer_store_id,sdate,today,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK


#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT a.`admin_id` FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and `category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(a.`admin_id`)as count FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and `category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and 
			a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(a.`date_of_creation`) between %s and %s and a.`pincode` in (%s)""",
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a
				 INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				 WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s  and `category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and
			date(`date_of_creation`) between %s and %s  and `pincode` in (%s) order by admin_id ASC limit %s""",
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,retailer_store_id,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
				WHERE a.`role_id`=4 and 
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and `category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				and a.`admin_id`>%s and date(a.`date_of_creation`) between %s and %s and 
				pincode in (%s) order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,retailer_store_id,start,sdate,today,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s  and p.`product_type` =%s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,organisation_id,organisation_id,retailer_store_id,start,organisation_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(ad.`admin_id`)as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(ad.`admin_id`))as 'count' FROM `admins` ad	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`		
			where ad.`admin_id` in(SELECT distinct(`customer_id`) FROM `customer_product_mapping` cpm		 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(ad.`date_of_creation`) BETWEEN %s and %s and 
			ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id,organisation_id,retailer_store_id))

		print(cursor._last_executed)

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id` in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,category_id,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:			
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s ) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and date(ad.`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,category_id,start,organisation_id,organisation_id,retailer_store_id,sdate,today,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		if next_url:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		scost = float(startingcost)
		ecost = float(endingcost)

		customerList_query = cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,category_id,organisation_id))
		customer_list_data = cursor.fetchall()
		
		cursor.execute("""SELECT admin_id FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and date(`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,organisation_id,retailer_store_id,sdate,today,organisation_id,scost,ecost,product_type,organisation_id,category_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					and date(`date_of_creation`) between %s and %s""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:	
						customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and
						`admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,product_type,organisation_id,category_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
					and date(`date_of_creation`) between %s and %s and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
					`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,organisation_id,retailer_store_id,sdate,today,product_type,organisation_id,category_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))				

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s 
						and `admin_id` in %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,product_type,organisation_id,category_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

			if prdcusmrDtls:

				page_next = page + 1			
				if cur_count < total_count:
					next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
				else:
					next_url = ''
			else:
				next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))		

			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')

		total_count = len(details)
		print(total_count)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					print(customerids)

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s  and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						 WHERE `product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s  and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#


#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s  and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					if payment_count > 0:											
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
						ad.`admin_id` in %s and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#
@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom 
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,category_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
			
			if payment_count > 0:					
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:						
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						cscost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0			 	
						
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom 
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s nad p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s """,(userDtls[i]['admin_id'],organisation_id,scost,ecost))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids :
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost)
					 	
						cursor.execute("""SELECT `amount` as total FROM 
							`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0						
						
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#--------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateProductType/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<string:product_type>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateProductType(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,product_type):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) order by admin_id ASC limit %s""",
			(product_type,organisation_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s ) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) order by admin_id ASC limit %s""",
				(product_type,organisation_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`))as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) """,
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s  and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) order by admin_id ASC limit %s""",
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				 INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				 WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s""",
			(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE `product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,product_type,organisation_id,category_id,organisation_id))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s
			and a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s  and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,product_type,organisation_id,category_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where 
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s 
						and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC limit %s""",
						(organisation_id,sdate,today,customerids,product_type,organisation_id,category_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s""",
					(organisation_id,sdate,today))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s 
						and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
						order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,product_type,organisation_id,category_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#


#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a			
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping`pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s  and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		print(userDtls)

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE `product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,start,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				print(userDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])	
				print(customerids)									

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,category_id,pincode,organisation_id,sdate,today))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and p.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,start,pincode,organisation_id,sdate,today,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id` 
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id` 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`role_id`=4 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s  and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
				and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				if customerdata[i]['date_of_creation'] == '0000-00-00 00:00:00':
					customerdata[i]['date_of_creation'] = '0000-00-00 00:00:00'
				else:
					customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''
					
				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT `amount` as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<int:pincode>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePincodeOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(a.`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) 
			and a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(a.`admin_id`)) as count FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			WHERE a.`role_id`=4 and 
			a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s  and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
			a.`status`=1 and a.`organisation_id`= %s and iip.`organisation_id` = %s and
			date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet` FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and 
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
				a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s and
				date(a.`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and `pincode` in (%s)  and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
			(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			# print(customerdata)
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0

				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`admin_id`)as admin_id,concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,profile_image,`pincode`,date_of_creation,`loggedin_status`,`wallet`
				FROM `admins` a 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
				WHERE a.`role_id`=4 and
				a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
				`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)
				and a.`status`=1 and a.`organisation_id`=%s and iip.`organisation_id` = %s
				and admin_id>%s and date(`date_of_creation`) between %s and %s and date(iip.`last_update_ts`) between %s and %s and
				pincode in (%s) and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(product_type,organisation_id,category_id,organisation_id,organisation_id,organisation_id,start,sdate,today,start_date,end_date,pincode,organisation_id,retailer_store_id,limit))

			customerdata = cursor.fetchall()
			
			for i in range(len(customerdata)):
				customerdata[i]['dob'] = customerdata[i]['dob']
				customerdata[i]['date_of_creation'] = customerdata[i]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(customerdata[i]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					customerdata[i]['customertype'] = customertype['customer_type']
				else:
					customerdata[i]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (customerdata[i]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					customerdata[i]['retailer_city'] = city_data['retailer_city']
					customerdata[i]['retailer_address'] = city_data['retailer_address']
				else:
					customerdata[i]['retailer_city'] = ""
					customerdata[i]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (customerdata[i]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					customerdata[i]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					customerdata[i]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (customerdata[i]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					customerdata[i]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[i]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s """,(customerdata[i]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					customerdata[i]['purchase_cost'] = costDtls['total']
				else:
					customerdata[i]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(customerdata[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": customerdata}), status.HTTP_200_OK

#---------------------------------------------------------------------#

#---------------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		adminid = []

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
			pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id` 
			where `admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom 
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
			pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					customerdata[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom 
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
				(brand,organisation_id,product_type,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0

		page_next = page + 1
		if cur_count < total_count:
			next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#


#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandModelOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,model,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		split_model = model.split(',')

		customerList_query = cursor.execute("""SELECT distinct(`admin_id`) FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))
		customer_list_data = cursor.fetchall()

		cursor.execute("""SELECT count(distinct(`admin_id`))as 'count' FROM `admins` a
			INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
			and `customer_id` !=0)) and date(a.`date_of_creation`) BETWEEN %s and %s and 
			a.`organisation_id`=%s and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s """,
			(brand,organisation_id,split_model,product_type,category_id,sdate,today,organisation_id,organisation_id,start_date,end_date,organisation_id,retailer_store_id))

		countDtls = cursor.fetchone()
		total_count = countDtls.get('count')
		# print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if start == 0:
			previous_url = ''

			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and 
				iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			# print(prdcusmrDtls)
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
			 	
				cursor.execute("""SELECT sum(`amount`) as total FROM 
					`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0
		else:
			cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
				concat(`first_name`,' ',`last_name`)as name,
				concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
				`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
				`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
				`customer_product_mapping` cpm, `admins` ad 
				INNER JOIN `instamojo_initiate_payment` iip ON iip.`user_id` = ad.`admin_id`
				INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
				WHERE `product_meta_id` in(SELECT 
				product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s)
				and `customer_id` !=0) and 
				cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and
				ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s
				and iip.`organisation_id` = %s and date(iip.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
				order by admin_id ASC limit %s""",
				(brand,organisation_id,split_model,product_type,category_id,start,organisation_id,sdate,today,organisation_id,start_date,end_date,organisation_id,retailer_store_id,limit))

			prdcusmrDtls = cursor.fetchall()
			
			for cid in range(len(prdcusmrDtls)):
				prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
				prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

				cursor.execute("""SELECT `customer_type` FROM 
					`customer_type` where`customer_id`=%s and 
					`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
				customertype = cursor.fetchone()
				if customertype:
					prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
				else:
					prdcusmrDtls[cid]['customertype'] = ''

				get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
							FROM `user_retailer_mapping` ur 
							INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
							INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
							where ur.`user_id` = %s and ur.`organisation_id` = %s""")
				get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				count_city = cursor.execute(get_city_query,get_city_data)						

				if count_city > 0:
					city_data = cursor.fetchone()
					prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
					prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
				else:
					prdcusmrDtls[cid]['retailer_city'] = ""
					prdcusmrDtls[cid]['retailer_address'] = ""

				get_exchange_count_query = ("""SELECT count(*) exchane_count
														 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
				get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

				if exchange_count > 0:
					exchange_count_data =  cursor.fetchone()
					prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
				else:
					prdcusmrDtls[cid]['exchange_count'] = 0

				get_enquieycount_query = ("""SELECT count(*) enquiery_count
														 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
				get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
				enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

				if enquiery_count > 0:
					enquiery_count_data = cursor.fetchone()
					prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
				else:
					prdcusmrDtls[cid]['enquiery_count'] = 0
				
				cursor.execute("""SELECT sum(`amount`) as total FROM 
			 		`instamojo_payment_request` WHERE `user_id`=%s""",(prdcusmrDtls[cid]['admin_id']))
				costDtls = cursor.fetchone()
				if costDtls['total'] != None:
					prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
				else:
					prdcusmrDtls[cid]['purchase_cost'] = 0


		if prdcusmrDtls:			
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK


#-------------------------------------------------------------------#

#-------------------------------------------------------------------#
@name_space.route("/getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDatePurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,pcost,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))		

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		scost = float(startingcost)
		ecost = float(endingcost) 

		customerList_query = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and `admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id,product_type,organisation_id,category_id,organisation_id))
		customer_list_data = cursor.fetchall()

		payment_count = cursor.execute("""SELECT distinct(admin_id) FROM `admins` a
			INNER JOIN `instamojo_payment_request` ipr on ipr.`user_id` = a.`admin_id`
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
			WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ipr.`organisation_id` = %s and amount BETWEEN %s and %s and date(ipr.`last_update_ts`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
			and `admin_id` in (SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
			(organisation_id,sdate,today,organisation_id,scost,ecost,start_date,end_date,organisation_id,retailer_store_id,product_type,organisation_id,category_id,organisation_id))
		userDtls = cursor.fetchall()		
		
		total_count = len(userDtls)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
	
		if total_count == 0:
			prdcusmrDtls = []
		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s) and
						`organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s order by admin_id ASC limit %s""",
						(product_type,organisation_id,category_id,organisation_id,organisation_id,sdate,today,customerids,limit))

					prdcusmrDtls = cursor.fetchall()
					
					if prdcusmrDtls != None:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls =[]
			else:
				cursor.execute("""SELECT admin_id FROM `admins` a
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`
					WHERE a.`organisation_id`=%s and date(a.`date_of_creation`) between %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)""",
					(organisation_id,sdate,today,organisation_id,retailer_store_id,product_type,organisation_id,category_id,organisation_id))
				userDtls = cursor.fetchall()
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					print(cursor._last_executed)

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print(userDtls[i]['admin_id'])				

				if customerids:
				
					cursor.execute("""SELECT `admin_id`,
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` 
						FROM `admins` where `organisation_id`=%s and date(`date_of_creation`) 
						between %s and %s and `admin_id` in %s and `admin_id`>%s and `admin_id` in (SELECT distinct(`customer_id`) FROM 
						`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE p.`product_type` = %s and pom.`organisation_id` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`= %s)order by admin_id ASC
						limit %s""",(organisation_id,sdate,today,customerids,start,product_type,organisation_id,category_id,organisation_id,limit))

					prdcusmrDtls = cursor.fetchall()
					if prdcusmrDtls:
						for cid in range(len(prdcusmrDtls)):
							prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
							prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

							cursor.execute("""SELECT `customer_type` FROM 
								`customer_type` where`customer_id`=%s and 
								`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
							customertype = cursor.fetchone()
							if customertype:
								prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
							else:
								prdcusmrDtls[cid]['customertype'] = ''

							get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
							get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							count_city = cursor.execute(get_city_query,get_city_data)						

							if count_city > 0:
								city_data = cursor.fetchone()
								prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
								prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
							else:
								prdcusmrDtls[cid]['retailer_city'] = ""
								prdcusmrDtls[cid]['retailer_address'] = ""

							get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
							get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

							if exchange_count > 0:
								exchange_count_data =  cursor.fetchone()
								prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
							else:
								prdcusmrDtls[cid]['exchange_count'] = 0

							get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
							get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
							enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

							if enquiery_count > 0:
								enquiery_count_data = cursor.fetchone()
								prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
							else:
								prdcusmrDtls[cid]['enquiery_count'] = 0
							
							scost = float(startingcost)
							ecost = float(endingcost) 

							cursor.execute("""SELECT `amount`as total FROM 
						 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
							print(cursor._last_executed)
							costDtls = cursor.fetchone()
							if costDtls['total'] != None:
								prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
							else:
								prdcusmrDtls[cid]['purchase_cost'] = 0
					else:
						prdcusmrDtls = []
				print(cursor._last_executed)

		if prdcusmrDtls:
			page_next = page + 1			
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByDateBrandPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,pcost,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		cursor.execute("""SELECT distinct(`admin_id`)as 'admin_id' FROM `admins` a	
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = a.`admin_id`		
			where a.`admin_id` in(SELECT distinct(`customer_id`) FROM 
			`customer_product_mapping` WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
				pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and `organisation_id`=%s) and 
			date(a.`date_of_creation`) BETWEEN %s and %s and a.`organisation_id`=%s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s""",
			(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,organisation_id,retailer_store_id))		

		userDtls = cursor.fetchall()		

		for i in range(len(userDtls)):			
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			

			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
		
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)		
	
		if total_count == 0:
			prdcusmrDtls = []
		
		else:
		
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(ad.`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):					
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')

				print(customerids)		

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom 
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					print(cursor._last_executed)

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
					pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id ASC limit %s""",
					(brand,organisation_id,product_type,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					

					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						details.append(userDtls[i]['admin_id'])		
					else:
						print('hiii')

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) and 
						pom.`organisation_id` = %s and p.`product_type` = %s and p.`category_id` = %s) and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and 
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id ASC limit %s""",
						(brand,organisation_id,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:
			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------#

#---------------------------------------------------------------#
@name_space.route("/getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,brand,model,pcost,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
				pom.`product_id` FROM `product_organisation_mapping` pom
				INNER JOIN `product` p on p.`product_id` = pom.`product_id`
				WHERE pom.`product_id`in(SELECT product_id 
				FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
				and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
				and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			print(userDtls[i]['admin_id'])
			scost = float(startingcost)
			ecost = float(endingcost)

			payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:	
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})				
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hii')

		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and `amount` BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					if payment_count > 0:					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')	

					print(customerids)			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						print(cursor._last_executed)
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id` 
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and 
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,category_id,start,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost) 

					payment_count = cursor.execute("""SELECT user_id FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))

					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')										

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`category_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,category_id,start,customerids,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
					
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#----------------------------------------------------------------#

#----------------------------------------------------------------#

@name_space.route("/getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId/<string:sdate>/<int:pincode>/<string:brand>/<string:model>/<string:pcost>/<int:organisation_id>/<string:purchase_date>/<int:retailer_store_id>/<string:product_type>/<int:category_id>",
	doc={'params':{'start':'adminId','limit':'limit','page':'pageno'}})
class getCustomerListByPincodeBrandModelPurchaseCostOrganizationIdPurchaseDateRetailStoreProductTypeCategoryId(Resource):
	def get(self,sdate,pincode,brand,model,pcost,organisation_id,purchase_date,retailer_store_id,product_type,category_id):
		connection = mysql_connection()
		cursor = connection.cursor()
		today = date.today()
		details = []
		customerids = []
		customer_list_data = []

		start=int(request.args.get('start', 0))
		limit=int(request.args.get('limit', 10))
		page=int(request.args.get('page', 1))

		previous_url = ''
		next_url = ''

		pcostrange = pcost.split("-", 1)
		startingcost = pcostrange[0]
		endingcost = pcostrange[1]

		purchase_date_range = purchase_date.split(",", 1)
		start_date = purchase_date_range[0]
		end_date = purchase_date_range[1]

		split_model = model.split(',')

		cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
			`customer_product_mapping` cpm, `admins` ad 
			INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
			WHERE `product_meta_id` in(SELECT 
			product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
			pom.`product_id` FROM `product_organisation_mapping` pom
			INNER JOIN `product` p on p.`product_id` = pom.`product_id`
			WHERE pom.`product_id`in(SELECT product_id 
			FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
			and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`caegory_id` = %s) 
			and `customer_id` !=0) and 
			cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in (%s) and 
			ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s 
			order by admin_id Asc""",
			(brand,organisation_id,split_model,product_type,caegory_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id))

		userDtls = cursor.fetchall()

		for i in range(len(userDtls)):
			scost = float(startingcost)
			ecost = float(endingcost) 

			payment_count =  cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
				WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
			
			if payment_count > 0:
				customer_list_data.append({'admin_id':userDtls[i]['admin_id']})					
				print(userDtls[i]['admin_id'])
				details.append(userDtls[i]['admin_id'])		
			else:
				print('hiii')
				
		total_count = len(details)
		print(total_count)
		cur_count = int(page) * int(limit)
		# print(cur_count)
		
		if total_count == 0:
			prdcusmrDtls = []

		else:
			if start == 0:
				previous_url = ''

				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`caegory_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,caegory_id,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)
					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:
					
						print(userDtls[i]['admin_id'])
						customerids.append(userDtls[i]['admin_id'])		
					else:
						print('hello')			

				if customerids:

					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						 WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`caegory_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id` in %s and ad.`pincode` in(%s) and
						ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s order by admin_id Asc limit %s""",
						(brand,organisation_id,split_model,product_type,caegory_id,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					# print(prdcusmrDtls)
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''

						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0
					 	
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				 	
				else:
					prdcusmrDtls = []
			else:
				cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id' FROM 
					`customer_product_mapping` cpm, `admins` ad 
					INNER JOIN `user_retailer_mapping` ur ON ur.`user_id` = ad.`admin_id`
					WHERE `product_meta_id` in(SELECT 
					product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
					pom.`product_id` FROM `product_organisation_mapping` pom
					INNER JOIN `product` p on p.`product_id` = pom.`product_id`
					WHERE pom.`product_id`in(SELECT product_id 
					FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
					and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %s and p.`caegory_id` = %s) 
					and `customer_id` !=0) and 
					cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`pincode` in(%s) and
					ad.`organisation_id`=%s and date(`date_of_creation`) BETWEEN %s and %s and ur.`organisation_id` = %s and ur.`retailer_store_id` = %s
					order by admin_id Asc limit %s""",
					(brand,organisation_id,split_model,product_type,caegory_id,start,pincode,organisation_id,sdate,today,organisation_id,retailer_store_id,limit))

				userDtls = cursor.fetchall()
				# print(prdcusmrDtls)
				for i in range(len(userDtls)):
					scost = float(startingcost)
					ecost = float(endingcost)

					payment_count = cursor.execute("""SELECT `user_id` FROM `instamojo_payment_request` 
						WHERE user_id=%s and `organisation_id` =%s and amount BETWEEN %s and %s and date(`last_update_ts`) BETWEEN %s and %s""",(userDtls[i]['admin_id'],organisation_id,scost,ecost,start_date,end_date))
					
					if payment_count > 0:						
						customerids.append(userDtls[i]['admin_id'])
				customerids = tuple(customerids)

				if customerids:
				
					cursor.execute("""SELECT distinct(`customer_id`)as 'admin_id',
						concat(`first_name`,' ',`last_name`)as name,
						concat('address line1-',`address_line_1`,',','address line2-',`address_line_2`,',','city-',`city`,',','state-',`state`)as address,
						`address_line_1`,`address_line_2`,`city`,`country`,`state`,`anniversary`,
						`dob`,`phoneno`,`pincode`,profile_image,date_of_creation,`loggedin_status`,`wallet` FROM 
						`customer_product_mapping` cpm, `admins` ad WHERE `product_meta_id` in(SELECT 
						product_meta_id FROM `product_meta` WHERE `product_id` in(SELECT 
						pom.`product_id` FROM `product_organisation_mapping` pom
						INNER JOIN `product` p on p.`product_id` = pom.`product_id`
						WHERE pom.`product_id`in(SELECT product_id 
						FROM `product_brand_mapping` WHERE `brand_id` in (%s)) 
						and pom.`organisation_id` = %s and pom.`product_id` in %s and p.`product_type` = %S and p.`caegory_id` = %s) 
						and `customer_id` !=0) and 
						cpm.`customer_id` = ad.`admin_id` and ad.`admin_id`>%s and ad.`admin_id` in %s 
						and ad.`pincode` in(%s) and ad.`organisation_id`=%s and 
						date(`date_of_creation`) BETWEEN %s and %s limit %s""",
						(brand,organisation_id,split_model,product_type,caegory_id,start,customerids,pincode,organisation_id,sdate,today,limit))

					prdcusmrDtls = cursor.fetchall()
					
					for cid in range(len(prdcusmrDtls)):
						prdcusmrDtls[cid]['dob'] = prdcusmrDtls[cid]['dob']
						prdcusmrDtls[cid]['date_of_creation'] = prdcusmrDtls[cid]['date_of_creation'].isoformat()

						cursor.execute("""SELECT `customer_type` FROM 
							`customer_type` where`customer_id`=%s and 
							`organisation_id`=%s""",(prdcusmrDtls[cid]['admin_id'],organisation_id))
						customertype = cursor.fetchone()
						if customertype:
							prdcusmrDtls[cid]['customertype'] = customertype['customer_type']
						else:
							prdcusmrDtls[cid]['customertype'] = ''
							
						get_city_query = ("""SELECT rs.`city` as retailer_city,rss.`address` as retailer_address
								FROM `user_retailer_mapping` ur 
								INNER JOIN `retailer_store` rs ON rs.`retailer_store_id` = ur.`retailer_id` 
								INNER JOIN `retailer_store_stores` rss ON rss.`retailer_store_store_id` = ur.`retailer_store_id`
								where ur.`user_id` = %s and ur.`organisation_id` = %s""")
						get_city_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						count_city = cursor.execute(get_city_query,get_city_data)						

						if count_city > 0:
							city_data = cursor.fetchone()
							prdcusmrDtls[cid]['retailer_city'] = city_data['retailer_city']
							prdcusmrDtls[cid]['retailer_address'] = city_data['retailer_address']
						else:
							prdcusmrDtls[cid]['retailer_city'] = ""
							prdcusmrDtls[cid]['retailer_address'] = ""

						get_exchange_count_query = ("""SELECT count(*) exchane_count
																	 FROM customer_exchange_device where `customer_id` = %s and `organisation_id` = %s""")
						get_exchange_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						exchange_count = cursor.execute(get_exchange_count_query,get_exchange_count_data)						

						if exchange_count > 0:
							exchange_count_data =  cursor.fetchone()
							prdcusmrDtls[cid]['exchange_count'] = exchange_count_data['exchane_count']
						else:
							prdcusmrDtls[cid]['exchange_count'] = 0

						get_enquieycount_query = ("""SELECT count(*) enquiery_count
																	 FROM enquiry_master where `user_id` = %s and `organisation_id` = %s""")
						get_enquiery_count_data = (prdcusmrDtls[cid]['admin_id'],organisation_id)
						enquiery_count = cursor.execute(get_enquieycount_query,get_enquiery_count_data)

						if enquiery_count > 0:
							enquiery_count_data = cursor.fetchone()
							prdcusmrDtls[cid]['enquiery_count'] = enquiery_count_data['enquiery_count']
						else:
							prdcusmrDtls[cid]['enquiery_count'] = 0			 	
						
						scost = float(startingcost)
						ecost = float(endingcost) 

						cursor.execute("""SELECT `amount`as total FROM 
					 		`instamojo_payment_request` WHERE `user_id`=%s and `amount` BETWEEN %s and %s""",(prdcusmrDtls[cid]['admin_id'],scost,ecost))
						costDtls = cursor.fetchone()
						if costDtls['total'] != None:
							prdcusmrDtls[cid]['purchase_cost'] = costDtls['total']
						else:
							prdcusmrDtls[cid]['purchase_cost'] = 0
				else:
					prdcusmrDtls = []

		if prdcusmrDtls:

			page_next = page + 1
			if cur_count < total_count:
				next_url = '?start={}&limit={}&page={}'.format(prdcusmrDtls[-1].get('admin_id'),limit,page_next)
			else:
				next_url = ''
		else:
			next_url = ''
				
		connection.commit()
		cursor.close()
		return ({"attributes": {"status_desc": "Customer List",
	                            "status": "success",
	                            "total":total_count,
								'previous':previous_url,
								'next':next_url,
								'customer_list':customer_list_data
								},
	             "responseList": prdcusmrDtls}), status.HTTP_200_OK

#---------------------------------------------------------------------#













